<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_angular_provider">
    <sp_angular_provider action="INSERT_OR_UPDATE">
        <name>CatalogItemNavigator</name>
        <script><![CDATA[function CatalogItemNavigator($http, $timeout) {
	var States = {
		'Initial': 'Initial',
		'Loading': 'Loading',
		'Loaded': 'Loaded'
	};

	var sections = [];
	var selectedIndex;
	var state = States.Initial;
	var g_form;
	var mrvsStates = {};

	function initialize() {
		sections = [];
		selectedIndex = 0;
		state = States.Initial;
		g_form = '';
	}

	function selectInitialSection() {
		selectedIndex = 0;
		selectSection(sections[0], true);
	}

	function load(catItemId, gForm) {
		if (state == States.Initial) {
			state = States.Loading;
			g_form = gForm;

			$http.get('/api/apig/catalog_toolkit/getCatItemSections?catItemId=' + catItemId)
				.then(function(res) {
				sections = res.data.result.sections;
				state = States.Loaded;
				selectInitialSection();
			});
		}
	}

	function setContainerVisible(key, value) {
		var field = g_form.getField(key);
		field._visible = value;
	}

	function setSectionVisibility(section, isSelected, ignoreMRVS) {	
		ignoreMRVS = ignoreMRVS || false;
		var mrvsNames = section.mrvs_names;
		if (section.containers) {
			section.containers.forEach(function(key) {
				if(mrvsNames.indexOf(key) == -1 || (mrvsNames.indexOf(key) != -1 && ignoreMRVS == false)){
					if(mrvsNames.indexOf(key) != -1 && mrvsStates[key] != null){
						isSelected = mrvsStates[key];
					}
					setContainerVisible(key, isSelected);
				}
			});
		}
		else {
			setContainerVisible(section.key, isSelected);
		}
	}

	function selectSection(selected, ignoreMRVS) {
		ignoreMRVS = ignoreMRVS || false;

		sections.forEach(function(section, ix) {
			var isSelected = selected.key == section.key;
			var wasSelected = selectedIndex == ix;
			
			section.isSelected = isSelected;
			if (wasSelected && !ignoreMRVS) {
				var mrvsNames = section.mrvs_names;
				mrvsNames.forEach(function(name){
					var mrvs = g_form.getField(name);
					mrvsStates[name] = mrvs._visible;
				});
			}
			
			setSectionVisibility(section, isSelected, ignoreMRVS);
			
			if (isSelected) {
				selectedIndex = ix;
			}
		});
	}

	function showAll() {
		sections.forEach(function(section) {
			setSectionVisibility(section, true);
			section.isSelected = false;
			selectedIndex = null;
		});
	}

	function submit() {
		$timeout(function() {
			$("[name='submit']").trigger('click');
		});
	}

	function hasNext() {
		return selectedIndex < sections.length - 1;
	}

	function next() {
		if (hasNext()) {
			selectSection(sections[selectedIndex + 1]);
		}
	}

	function hasPrevious() {
		return selectedIndex > 0;
	}

	function previous() {
		if (hasPrevious()) {
			selectSection(sections[selectedIndex - 1]);
		}
	}

	function getSections() {
		return sections;
	}

	function getState() {
		return state;
	}

	function getCurrentSelectedIndex() {
		return selectedIndex;
	}

	return {
		'load': load,
		'selectSection': selectSection,
		'showAll': showAll,
		'submit': submit,
		'hasNext': hasNext,
		'next': next,
		'hasPrevious': hasPrevious,
		'previous': previous,
		'getSections': getSections,
		'getState': getState,
		'getCurrentSelectedIndex': getCurrentSelectedIndex,
		'initialize': initialize
	};
}]]></script>
        <sys_class_name>sp_angular_provider</sys_class_name>
        <sys_created_by>Terry.Lillo</sys_created_by>
        <sys_created_on>2022-08-04 16:35:33</sys_created_on>
        <sys_id>2775feee1bc9159062e50ed2cd4bcb28</sys_id>
        <sys_mod_count>36</sys_mod_count>
        <sys_name>CatalogItemNavigator</sys_name>
        <sys_package display_value="Custom Service Portal Widgets" source="526506cc1b89d1508c5143f3cc4bcb99">526506cc1b89d1508c5143f3cc4bcb99</sys_package>
        <sys_policy/>
        <sys_scope display_value="Custom Service Portal Widgets">526506cc1b89d1508c5143f3cc4bcb99</sys_scope>
        <sys_update_name>sp_angular_provider_2775feee1bc9159062e50ed2cd4bcb28</sys_update_name>
        <sys_updated_by>Terry.Lillo</sys_updated_by>
        <sys_updated_on>2022-11-15 15:47:18</sys_updated_on>
        <type>service</type>
    </sp_angular_provider>
</record_update>
